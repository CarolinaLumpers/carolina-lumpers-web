<h2>Employee Login / Signup</h2>

<form id="signupForm">
  <h3>Sign Up</h3>
  <input type="email" id="signupEmail" placeholder="Work Email" required><br>
  <input type="password" id="signupPassword" placeholder="New Password" required><br>
  <button type="submit">Create Account</button>
</form>

<form id="loginForm">
  <h3>Login</h3>
  <input type="email" id="loginEmail" placeholder="Email" required><br>
  <input type="password" id="loginPassword" placeholder="Password" required><br>
  <button type="submit">Login</button>
</form>

<div id="message"></div>

<script>
document.getElementById("loginForm").onsubmit = async function(e) {
  e.preventDefault();
  const email = document.getElementById("loginEmail").value;
  const password = document.getElementById("loginPassword").value;

  const apiBase = "https://script.google.com/macros/s/AKfycbwHBLEQ5QHuhD-O4uI4hRN_5_yS9YsFgtn_dMAdoAO2C7zHLoi3qfHO82vas3Uv0wXXpg/exec";
  const url = `${apiBase}?action=login&email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`;

  const res = await fetch(url);
  const text = await res.text();

  if (text.includes("âœ… Login successful")) {
    // get worker ID and redirect to dashboard
    const workerId = await getWorkerIdByEmail(email);
    if (workerId) {
      window.location.href = `employeeDashboard.html?workerId=${workerId}&email=${encodeURIComponent(email)}`;
    } else {
      alert("Could not find your worker ID.");
    }
  } else {
    alert(text);
  }
};

async function getWorkerIdByEmail(email) {
  const lookupUrl = "https://script.google.com/macros/s/AKfycbwHBLEQ5QHuhD-O4uI4hRN_5_yS9YsFgtn_dMAdoAO2C7zHLoi3qfHO82vas3Uv0wXXpg/exec";
  const res = await fetch(`${lookupUrl}?action=getWorkerId&email=${encodeURIComponent(email)}`);
  return (await res.text()).trim();
}
</script>

